# Parte 2: Destruição
name: Deploy AWS Lambda - Destroy

on:
 push:
   branches:
     - destroy/cluster

jobs:
 deploy:
   runs-on: ubuntu-latest

   steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up AWS CLI
      run: |
        echo ${{ secrets.AWS_ACCESS_KEY_ID }} > aws_access_key_id
        echo ${{ secrets.AWS_SECRET_ACCESS_KEY }} > aws_secret_access_key
        aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws configure set default.region us-east-1

    - name: Set up Terraform
      uses: hashicorp/setup-terraform@v2
      with:
       terraform_version: latest

    - name: Terraform Init
      run: |
        cd infra
        terraform init -backend-config="path=./terraform.tfstate"

    - name: Terraform Destroy
      run: |
       cd infra
       terraform destroy -auto-approve
